<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Oracle</title>
    <meta name="description" content="Answer 3 absurd questions. Get a film recommendation that somehow feels right.">
    <link rel="icon" type="image/png" href="cinema.png">
    <meta property="og:title" content="Movie Oracle">
    <meta property="og:description" content="Answer 3 absurd questions. Get a film recommendation that somehow feels right.">
    <meta property="og:image" content="https://saberzou.github.io/movie-oracle/cinema.png">
    <meta property="og:type" content="website">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
/* =============================================
   RESET & BASE
   ============================================= */
*, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --bg: #0a0a0f;
    --bg-grid: rgba(255, 255, 255, 0.03);
    --surface: rgba(255, 255, 255, 0.05);
    --surface-hover: rgba(255, 255, 255, 0.08);
    --text: #f0f0f0;
    --text-dim: rgba(255, 255, 255, 0.5);
    --text-muted: rgba(255, 255, 255, 0.3);
    --blue: #ec4899;
    --pink: #ec4899;
    --orange: #f97316;
    --yellow: #eab308;
    --green: #22c55e;
    --purple: #a855f7;
    --radius: 12px;
    --radius-pill: 100px;
}

html, body {
    height: 100%;
    overflow: hidden;
    overflow-y: auto;
}

body {
    font-family: 'DM Sans', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    -webkit-font-smoothing: antialiased;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* =============================================
   GRID TEXTURE BACKGROUND
   ============================================= */
body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
        linear-gradient(var(--bg-grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--bg-grid) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
}

/* =============================================
   APP CONTAINER
   ============================================= */
.app {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 480px;
    min-height: 100vh;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 32px 24px;
    text-align: center;
}

/* =============================================
   DECO IMAGES — edge-bleeding background elements
   ============================================= */
.deco {
    position: fixed;
    pointer-events: none;
    z-index: 0;
    opacity: 0.2;
    mix-blend-mode: screen;
}

.deco-wtf {
    width: 220px;
    top: 5%;
    left: -70px;
    animation: floatA 7s ease-in-out infinite;
}

.deco-alien {
    width: 200px;
    top: 8%;
    right: -65px;
    animation: floatB 8s ease-in-out infinite;
}

.deco-cursor {
    width: 160px;
    bottom: 10%;
    left: -50px;
    animation: floatC 6.5s ease-in-out infinite;
}

.deco-tv {
    width: 240px;
    bottom: 5%;
    right: -80px;
    animation: floatA 9s ease-in-out infinite;
}

.deco img {
    width: 100%;
    height: auto;
    display: block;
}

@keyframes floatA {
    0%, 100% { transform: translateY(0) rotate(-2deg); }
    50% { transform: translateY(-12px) rotate(2deg); }
}

@keyframes floatB {
    0%, 100% { transform: translateY(0) rotate(2deg); }
    50% { transform: translateY(-10px) rotate(-3deg); }
}

@keyframes floatC {
    0%, 100% { transform: translateY(0) rotate(-3deg); }
    50% { transform: translateY(-14px) rotate(3deg); }
}

@media (max-width: 480px) {
    .deco-wtf { width: 140px; left: -45px; }
    .deco-alien { width: 130px; right: -42px; }
    .deco-cursor { width: 110px; left: -35px; }
    .deco-tv { width: 160px; right: -52px; }
}

@media (min-width: 768px) {
    .deco-wtf { width: 280px; left: -90px; }
    .deco-alien { width: 260px; right: -85px; }
    .deco-cursor { width: 200px; left: -65px; }
    .deco-tv { width: 300px; right: -100px; }
}

/* =============================================
   SCREENS — transition between states
   ============================================= */
.screen {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
}

.screen.active {
    display: flex;
    animation: fadeUp 0.4s ease both;
}

@keyframes fadeUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* =============================================
   LANDING SCREEN
   ============================================= */
.oracle-symbol {
    width: 400px;
    height: 400px;
    margin-bottom: 8px;
    overflow: visible;
    border: none;
    outline: none;
    background: none;
}

.oracle-symbol img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border: none;
    outline: none;
    mix-blend-mode: screen;
}

@media (max-width: 480px) {
    .oracle-symbol {
        width: 300px;
        height: 300px;
    }
}

.landing-title {
    font-family: 'Archivo Black', sans-serif;
    font-size: 3rem;
    line-height: 1;
    letter-spacing: -1px;
    text-transform: uppercase;
    margin-bottom: 12px;
}

.landing-subtitle {
    font-size: 1.1rem;
    color: var(--text-dim);
    margin-bottom: 48px;
    font-weight: 400;
}

/* =============================================
   BUTTONS
   ============================================= */
.btn-primary {
    font-family: 'Archivo Black', sans-serif;
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: var(--blue);
    color: #fff;
    border: none;
    padding: 18px 48px;
    border-radius: var(--radius-pill);
    cursor: pointer;
    transition: transform 0.15s, background 0.2s;
}

.btn-primary:hover {
    transform: scale(1.03);
}

.btn-primary:active {
    transform: scale(0.98);
}

.btn-secondary {
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: transparent;
    color: var(--text-dim);
    border: 1.5px solid rgba(255, 255, 255, 0.15);
    padding: 14px 36px;
    border-radius: var(--radius-pill);
    cursor: pointer;
    transition: all 0.2s;
}

.btn-secondary:hover {
    color: var(--text);
    border-color: rgba(255, 255, 255, 0.3);
}

/* =============================================
   QUESTION SCREEN
   ============================================= */
.question-progress {
    font-family: 'Archivo Black', sans-serif;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 3px;
    color: var(--text-muted);
    margin-bottom: 16px;
}

.question-text {
    font-family: 'Archivo Black', sans-serif;
    font-size: 2.4rem;
    line-height: 1.1;
    text-transform: uppercase;
    margin-bottom: 48px;
}

.answer-group {
    display: flex;
    gap: 16px;
    width: 100%;
    max-width: 360px;
}

.answer-btn {
    flex: 1;
    font-family: 'Archivo Black', sans-serif;
    font-size: 1.1rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    background: var(--surface);
    color: var(--text);
    border: 1.5px solid rgba(255, 255, 255, 0.08);
    padding: 24px 16px;
    border-radius: var(--radius);
    cursor: pointer;
    transition: all 0.2s;
}

.answer-btn:hover {
    background: var(--surface-hover);
    border-color: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.answer-btn:active {
    transform: translateY(0);
}

/* Color accents per question */
.q1 .answer-btn:first-child:hover { border-color: var(--orange); color: var(--orange); }
.q1 .answer-btn:last-child:hover { border-color: var(--green); color: var(--green); }
.q2 .answer-btn:first-child:hover { border-color: var(--blue); color: var(--blue); }
.q2 .answer-btn:last-child:hover { border-color: var(--pink); color: var(--pink); }
.q3 .answer-btn:first-child:hover { border-color: var(--yellow); color: var(--yellow); }
.q3 .answer-btn:last-child:hover { border-color: var(--purple); color: var(--purple); }

/* =============================================
   LOADING SCREEN
   ============================================= */
.loading-text {
    font-family: 'Archivo Black', sans-serif;
    font-size: 1.4rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--text-dim);
    animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
}

.loading-dots {
    display: flex;
    gap: 8px;
    margin-top: 24px;
}

.loading-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--purple);
    animation: dotBounce 1.2s ease-in-out infinite;
}

.loading-dots span:nth-child(2) { animation-delay: 0.15s; }
.loading-dots span:nth-child(3) { animation-delay: 0.3s; }

@keyframes dotBounce {
    0%, 80%, 100% { transform: scale(0.6); opacity: 0.3; }
    40% { transform: scale(1); opacity: 1; }
}

/* =============================================
   RESULT SCREEN
   ============================================= */
.result-poster {
    width: 220px;
    height: 330px;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow:
        0 8px 40px rgba(0, 0, 0, 0.5),
        0 0 80px rgba(168, 85, 247, 0.1);
    background: var(--surface);
    position: relative;
    cursor: pointer;
}

.result-poster img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.result-poster img.loaded {
    opacity: 1;
}

/* Shimmer loading effect */
.result-poster::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        110deg,
        transparent 20%,
        rgba(255, 255, 255, 0.15) 35%,
        rgba(255, 255, 255, 0.3) 50%,
        rgba(255, 255, 255, 0.15) 65%,
        transparent 80%
    );
    background-size: 300% 100%;
    animation: shimmer 1.8s ease-in-out infinite;
    pointer-events: none;
    transition: opacity 0.4s ease;
}

.result-poster.poster-loaded::after {
    animation: hintShimmer 6s ease-in-out 2s 1;
}

@keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

@keyframes hintShimmer {
    0%, 80% { background-position: 200% 0; opacity: 0; }
    85% { opacity: 1; }
    95% { background-position: -200% 0; opacity: 0; }
    100% { background-position: -200% 0; opacity: 0; }
}

.result-title {
    font-family: 'Archivo Black', sans-serif;
    font-size: 1.8rem;
    line-height: 1.15;
    text-transform: uppercase;
    margin-bottom: 8px;
}

.result-meta {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 20px;
    letter-spacing: 1px;
}

.result-hook {
    font-size: 1.05rem;
    color: var(--text-dim);
    line-height: 1.5;
    max-width: 340px;
    margin-bottom: 36px;
    font-style: italic;
}

.result-actions {
    display: flex;
    gap: 12px;
}

/* =============================================
   RESULT SCREEN — magic move layout
   ============================================= */
.result-top {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100vw;
    margin-bottom: 28px;
    position: relative;
    overflow: hidden;
}

#result .result-poster {
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 2;
    flex-shrink: 0;
    margin-bottom: 0;
}

.result-details {
    width: 0;
    overflow: hidden;
    opacity: 0;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease 0.15s;
    flex-shrink: 0;
}

.result-details.expanded {
    opacity: 1;
}

.details-inner {
    padding: 20px;
    text-align: left;
    transform: translateX(30px);
    opacity: 0;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1) 0.2s, opacity 0.4s ease 0.25s;
}

.result-details.expanded .details-inner {
    transform: translateX(0);
    opacity: 1;
}

.details-overview {
    font-size: 0.88rem;
    line-height: 1.65;
    color: var(--text-dim);
    margin-bottom: 12px;
}

.details-why {
    font-size: 0.82rem;
    color: var(--purple);
    font-style: italic;
    line-height: 1.5;
}

/* Mobile: poster slides half off left edge, info appears right */
@media (max-width: 480px) {
    #result.details-open .result-poster {
        transform: translateX(calc(-50% - 24px)) rotate(-3deg);
    }

    .result-details.expanded {
        width: 55vw;
    }

    .details-inner {
        width: 55vw;
        padding: 16px 12px;
    }

    .details-overview {
        font-size: 0.82rem;
    }
}

/* Desktop: poster shifts left, info beside it */
@media (min-width: 481px) {
    #result.details-open .result-poster {
        transform: translateX(-40px) rotate(-2deg);
    }

    .result-details.expanded {
        width: 280px;
    }

    .details-inner {
        width: 280px;
    }
}

/* =============================================
   ERROR STATE
   ============================================= */
.error-text {
    color: var(--pink);
    font-size: 0.9rem;
    margin-bottom: 24px;
}

/* =============================================
   RESPONSIVE
   ============================================= */
@media (max-width: 480px) {
    .landing-title {
        font-size: 2.4rem;
    }

    .question-text {
        font-size: 1.8rem;
    }

    .answer-group {
        max-width: 100%;
    }

    .result-poster {
        width: 180px;
        height: 270px;
    }

    .result-title {
        font-size: 1.4rem;
    }

    .result-actions {
        flex-direction: column;
        width: 100%;
        max-width: 280px;
    }

    .btn-primary, .btn-secondary {
        width: 100%;
    }
}

@media (min-height: 800px) {
    .result-poster {
        width: 260px;
        height: 390px;
    }
}
    </style>
</head>
<body>

<div class="app">

    <!-- DECO IMAGES -->
    <div class="deco deco-wtf"><img src="deco-wtf.png" alt=""></div>
    <div class="deco deco-alien"><img src="deco-alien.png" alt=""></div>
    <div class="deco deco-cursor"><img src="deco-cursor.png" alt=""></div>
    <div class="deco deco-tv"><img src="deco-tv.png" alt=""></div>

    <!-- LANDING -->
    <div class="screen active" id="landing">
        <div class="oracle-symbol"><img src="oracle-star.png" alt="Movie Oracle"></div>
        <h1 class="landing-title">Movie<br>Oracle</h1>
        <p class="landing-subtitle">Answer 3 questions. Get your perfect movie.</p>
        <button class="btn-primary" onclick="startOracle()">Consult the Oracle</button>
    </div>

    <!-- QUESTION -->
    <div class="screen" id="question">
        <div class="question-progress" id="questionProgress">1 / 3</div>
        <h2 class="question-text" id="questionText"></h2>
        <div class="answer-group" id="answerGroup">
            <button class="answer-btn" onclick="answer(0)" id="answerA"></button>
            <button class="answer-btn" onclick="answer(1)" id="answerB"></button>
        </div>
    </div>

    <!-- LOADING -->
    <div class="screen" id="loading">
        <div class="loading-text" id="loadingText">Consulting the Oracle...</div>
        <div class="loading-dots">
            <span></span><span></span><span></span>
        </div>
    </div>

    <!-- RESULT -->
    <div class="screen" id="result">
        <div class="result-top">
            <div class="result-poster" id="resultPoster">
                <img id="posterImg" src="" alt="Movie poster">
            </div>
            <div class="result-details" id="resultDetails">
                <div class="details-inner">
                    <p class="details-overview" id="detailsOverview"></p>
                    <p class="details-why" id="detailsWhy"></p>
                </div>
            </div>
        </div>
        <h2 class="result-title" id="resultTitle"></h2>
        <div class="result-meta" id="resultMeta"></div>
        <p class="result-hook" id="resultHook"></p>
        <div class="result-actions">
            <button class="btn-primary" onclick="watchAgain()">Next Movie</button>
            <button class="btn-secondary" onclick="startOver()">New Questions</button>
        </div>
    </div>

    <!-- ERROR -->
    <div class="screen" id="error">
        <p class="error-text" id="errorText">Something went wrong. The Oracle is resting.</p>
        <button class="btn-secondary" onclick="startOver()">Try Again</button>
    </div>

</div>

<script>
// =============================================
//  CONFIG
// =============================================
const TMDB_IMG = 'https://image.tmdb.org/t/p/w500';

// =============================================
//  QUESTIONS
// =============================================
const questionPool = [
    { text: 'Coffee or Tea?', options: ['Coffee', 'Tea'],
      filters: [
        { yearGte: '2000-01-01', genres: [28, 53, 878, 80] },
        { yearLte: '2010-12-31', genres: [18, 10749, 36, 10402] }
      ]},
    { text: 'Window or Aisle?', options: ['Window', 'Aisle'],
      filters: [
        { genres: [12, 14, 16] },
        { genres: [18, 9648] }
      ]},
    { text: 'Matching or Chaos?', options: ['Matching', 'Chaos'],
      filters: [
        { voteAvg: 7.5 },
        { genres: [878, 27, 9648], voteAvg: 6.5 }
      ]},
    { text: 'Sunrise or Sunset?', options: ['Sunrise', 'Sunset'],
      filters: [
        { genres: [12, 28, 16], yearGte: '2010-01-01' },
        { genres: [18, 10749, 80], yearLte: '2015-12-31' }
      ]},
    { text: 'Cat or Dog?', options: ['Cat', 'Dog'],
      filters: [
        { genres: [9648, 14, 878] },
        { genres: [12, 28, 35] }
      ]},
    { text: 'Rain or Snow?', options: ['Rain', 'Snow'],
      filters: [
        { genres: [18, 53, 80] },
        { genres: [14, 10751, 16] }
      ]},
    { text: 'Book or Movie first?', options: ['Book', 'Movie'],
      filters: [
        { voteAvg: 7.0, genres: [18, 36] },
        { genres: [28, 878, 12], yearGte: '2005-01-01' }
      ]},
    { text: 'City or Countryside?', options: ['City', 'Countryside'],
      filters: [
        { genres: [80, 53, 28], yearGte: '2000-01-01' },
        { genres: [18, 10749, 37] }
      ]},
    { text: 'Sweet or Salty?', options: ['Sweet', 'Salty'],
      filters: [
        { genres: [10749, 35, 10751] },
        { genres: [28, 80, 53] }
      ]},
    { text: 'Night owl or Early bird?', options: ['Night owl', 'Early bird'],
      filters: [
        { genres: [27, 9648, 53] },
        { genres: [12, 35, 10751], yearGte: '2000-01-01' }
      ]},
    { text: 'Minimalist or Maximalist?', options: ['Minimalist', 'Maximalist'],
      filters: [
        { voteAvg: 7.5, genres: [18, 9648] },
        { genres: [14, 28, 878, 12] }
      ]},
    { text: 'Routine or Spontaneity?', options: ['Routine', 'Spontaneity'],
      filters: [
        { voteAvg: 7.0, genres: [18, 36, 10752] },
        { genres: [35, 12, 14], voteAvg: 6.0 }
      ]},
    { text: 'Indie or Blockbuster?', options: ['Indie', 'Blockbuster'],
      filters: [
        { voteAvg: 7.2, genres: [18, 99] },
        { genres: [28, 12, 878], yearGte: '2008-01-01' }
      ]},
    { text: 'Road trip or Staycation?', options: ['Road trip', 'Staycation'],
      filters: [
        { genres: [12, 35] },
        { genres: [18, 9648] }
      ]},
    { text: 'Analog or Digital?', options: ['Analog', 'Digital'],
      filters: [
        { genres: [18, 36], yearLte: '2012-12-31' },
        { genres: [878, 53], yearGte: '2012-01-01' }
      ]},
    { text: 'Mountains or Ocean?', options: ['Mountains', 'Ocean'],
      filters: [
        { genres: [12, 18], yearGte: '1995-01-01' },
        { genres: [12, 53, 14], yearGte: '1995-01-01' }
      ]},
    { text: 'Stargazing or City lights?', options: ['Stargazing', 'City lights'],
      filters: [
        { genres: [878, 12] },
        { genres: [80, 9648, 18] }
      ]},
    { text: 'Solo hero or Ensemble?', options: ['Solo hero', 'Ensemble'],
      filters: [
        { genres: [28, 12] },
        { genres: [35, 18, 80] }
      ]},
    { text: 'Quiet or Loud?', options: ['Quiet', 'Loud'],
      filters: [
        { genres: [18, 9648], voteAvg: 7.3 },
        { genres: [28, 53, 12], voteAvg: 6.5 }
      ]},
    { text: 'Hopeful or Dark?', options: ['Hopeful', 'Dark'],
      filters: [
        { genres: [18, 10751], voteAvg: 7.0 },
        { genres: [53, 27, 9648] }
      ]},
    { text: 'Classic or Experimental?', options: ['Classic', 'Experimental'],
      filters: [
        { genres: [18, 36], voteAvg: 7.2 },
        { genres: [878, 53, 14], voteAvg: 6.6 }
      ]},
    { text: 'Fast or Slow burn?', options: ['Fast', 'Slow burn'],
      filters: [
        { genres: [28, 53, 80] },
        { genres: [18, 9648], voteAvg: 7.3 }
      ]},
    { text: 'Revenge or Redemption?', options: ['Revenge', 'Redemption'],
      filters: [
        { genres: [80, 53, 28] },
        { genres: [18, 36], voteAvg: 7.2 }
      ]},
    { text: 'Dream or Reality?', options: ['Dream', 'Reality'],
      filters: [
        { genres: [14, 878, 9648] },
        { genres: [18, 36] }
      ]},
    { text: 'Party or Cozy night?', options: ['Party', 'Cozy night'],
      filters: [
        { genres: [35, 10402] },
        { genres: [10749, 18] }
      ]},
    { text: 'Space or Sea?', options: ['Space', 'Sea'],
      filters: [
        { genres: [878, 12] },
        { genres: [12, 53] }
      ]},
    { text: 'Myth or Truth?', options: ['Myth', 'Truth'],
      filters: [
        { genres: [14, 12] },
        { genres: [36, 18] }
      ]},
    { text: 'Heist or Chase?', options: ['Heist', 'Chase'],
      filters: [
        { genres: [80, 53] },
        { genres: [28, 53] }
      ]},
    { text: 'Wit or Heart?', options: ['Wit', 'Heart'],
      filters: [
        { genres: [35, 18] },
        { genres: [10749, 18] }
      ]},
    { text: 'Underdog or Legend?', options: ['Underdog', 'Legend'],
      filters: [
        { genres: [18, 35] },
        { genres: [36, 18], voteAvg: 7.1 }
      ]},
    { text: 'Neon or Natural?', options: ['Neon', 'Natural'],
      filters: [
        { genres: [878, 80, 53] },
        { genres: [18, 10751] }
      ]},
    { text: 'Edge or Comfort?', options: ['Edge', 'Comfort'],
      filters: [
        { genres: [53, 27, 9648] },
        { genres: [35, 10751] }
      ]},
    { text: 'Plot twists or Slow reveal?', options: ['Plot twists', 'Slow reveal'],
      filters: [
        { genres: [9648, 53] },
        { genres: [18, 9648], voteAvg: 7.2 }
      ]},
    { text: 'Retro or Futuristic?', options: ['Retro', 'Futuristic'],
      filters: [
        { genres: [35, 80], yearLte: '2010-12-31' },
        { genres: [878, 28], yearGte: '2010-01-01' }
      ]},
    { text: 'Uplifting or Intense?', options: ['Uplifting', 'Intense'],
      filters: [
        { genres: [10751, 35], voteAvg: 6.8 },
        { genres: [53, 80, 28], voteAvg: 6.8 }
      ]},
    { text: 'Grounded or Surreal?', options: ['Grounded', 'Surreal'],
      filters: [
        { genres: [18, 36] },
        { genres: [14, 878, 9648] }
      ]},
    { text: 'Black coffee or Milk tea?', options: ['Black coffee', 'Milk tea'],
      filters: [
        { genres: [80, 53], voteAvg: 7.0 },
        { genres: [35, 10749], voteAvg: 6.8 }
      ]},
    { text: 'Storm or Calm?', options: ['Storm', 'Calm'],
      filters: [
        { genres: [53, 28, 12] },
        { genres: [18, 10749], voteAvg: 7.0 }
      ]},
    { text: 'Comedy or Tension?', options: ['Comedy', 'Tension'],
      filters: [
        { genres: [35, 10751] },
        { genres: [53, 9648] }
      ]},
    { text: 'Dream job or Escape?', options: ['Dream job', 'Escape'],
      filters: [
        { genres: [18, 35] },
        { genres: [12, 53] }
      ]},
    { text: 'Hand-drawn or CGI?', options: ['Hand-drawn', 'CGI'],
      filters: [
        { genres: [16, 10751], yearLte: '2012-12-31' },
        { genres: [16, 14], yearGte: '2012-01-01' }
      ]},
    { text: 'Morning light or Midnight?', options: ['Morning light', 'Midnight'],
      filters: [
        { genres: [10749, 18] },
        { genres: [27, 53, 9648] }
      ]},
    { text: 'Minimal dialogue or Talky?', options: ['Minimal', 'Talky'],
      filters: [
        { genres: [12, 53], voteAvg: 7.0 },
        { genres: [18, 35], voteAvg: 7.0 }
      ]},
    { text: 'Classic hero or Antihero?', options: ['Classic hero', 'Antihero'],
      filters: [
        { genres: [12, 28], voteAvg: 6.8 },
        { genres: [80, 53], voteAvg: 6.8 }
      ]},
    { text: 'Vinyl or Streaming?', options: ['Vinyl', 'Streaming'],
      filters: [
        { genres: [18, 10402], yearLte: '2005-12-31' },
        { genres: [35, 878], yearGte: '2015-01-01' }
      ]},
    { text: 'Rooftop or Basement?', options: ['Rooftop', 'Basement'],
      filters: [
        { genres: [10749, 12] },
        { genres: [27, 9648, 53] }
      ]},
    { text: 'Compass or Map?', options: ['Compass', 'Map'],
      filters: [
        { genres: [12, 14] },
        { genres: [53, 80], voteAvg: 7.0 }
      ]},
    { text: 'First chapter or Last page?', options: ['First chapter', 'Last page'],
      filters: [
        { genres: [12, 14, 878] },
        { genres: [18, 36], voteAvg: 7.2 }
      ]},
    { text: 'Candlelight or Neon?', options: ['Candlelight', 'Neon'],
      filters: [
        { genres: [10749, 18, 36] },
        { genres: [878, 80, 28] }
      ]},
    { text: 'Pen or Sword?', options: ['Pen', 'Sword'],
      filters: [
        { genres: [18, 9648], voteAvg: 7.0 },
        { genres: [28, 12, 14] }
      ]},
    { text: 'Puzzle or Instinct?', options: ['Puzzle', 'Instinct'],
      filters: [
        { genres: [9648, 878] },
        { genres: [28, 12, 53] }
      ]},
    { text: 'Mask or Mirror?', options: ['Mask', 'Mirror'],
      filters: [
        { genres: [9648, 53, 80] },
        { genres: [18, 10749] }
      ]},
    { text: 'Library or Arena?', options: ['Library', 'Arena'],
      filters: [
        { genres: [9648, 18, 36] },
        { genres: [28, 12] }
      ]},
    { text: 'Old film or Fresh release?', options: ['Old film', 'Fresh release'],
      filters: [
        { genres: [18, 36], yearLte: '2005-12-31' },
        { genres: [28, 878, 35], yearGte: '2020-01-01' }
      ]},
    { text: 'Fireplace or Bonfire?', options: ['Fireplace', 'Bonfire'],
      filters: [
        { genres: [10749, 18] },
        { genres: [12, 28, 35] }
      ]},
    { text: 'Whisper or Shout?', options: ['Whisper', 'Shout'],
      filters: [
        { genres: [9648, 18], voteAvg: 7.0 },
        { genres: [28, 35, 10402] }
      ]},
    { text: 'Labyrinth or Highway?', options: ['Labyrinth', 'Highway'],
      filters: [
        { genres: [9648, 14, 878] },
        { genres: [12, 28, 35] }
      ]},
    { text: 'Piano or Drums?', options: ['Piano', 'Drums'],
      filters: [
        { genres: [18, 10749, 10402] },
        { genres: [28, 53, 80] }
      ]},
    { text: 'Ghost or Robot?', options: ['Ghost', 'Robot'],
      filters: [
        { genres: [27, 14, 9648] },
        { genres: [878, 28] }
      ]},
    { text: 'Silk or Leather?', options: ['Silk', 'Leather'],
      filters: [
        { genres: [10749, 18] },
        { genres: [80, 28, 53] }
      ]},
    { text: 'Telescope or Microscope?', options: ['Telescope', 'Microscope'],
      filters: [
        { genres: [878, 12] },
        { genres: [9648, 53, 80] }
      ]},
];

// Shuffle and pick 3 questions per session
function pickQuestions() {
    const shuffled = [...questionPool].sort(() => Math.random() - 0.5);
    return shuffled.slice(0, 3);
}

let questions = pickQuestions();

const loadingMessages = [
    'Consulting the Oracle...',
    'Reading the film runes...',
    'Divining your perfect match...',
    'Scanning the archives...',
    'The prophecy unfolds...',
    'Decoding your taste...',
    'Summoning a classic...',
    'Aligning the reels...',
    'The Oracle deliberates...',
    'Peering into the filmverse...',
    'Your answers speak volumes...',
    'Almost there...',
];

// =============================================
//  ANSWER → GENRE MAPPING
// =============================================
function buildFilters(answers) {
    let genres = new Set();
    let yearGte = '1990-01-01';
    let yearLte = '2026-12-31';
    let voteAvg = 6.0;

    questions.forEach((q, i) => {
        const f = q.filters[answers[i]];
        if (f.genres) f.genres.forEach(g => genres.add(g));
        if (f.yearGte && f.yearGte > yearGte) yearGte = f.yearGte;
        if (f.yearLte && f.yearLte < yearLte) yearLte = f.yearLte;
        if (f.voteAvg && f.voteAvg > voteAvg) voteAvg = f.voteAvg;
    });

    if (yearGte < '1990-01-01') yearGte = '1990-01-01';
    if (yearLte < '1990-01-01') yearLte = '1990-12-31';

    // Pick top 3 genres (TMDB allows comma-separated OR via pipe)
    const genreArr = [...genres];
    const selectedGenres = genreArr.sort(() => Math.random() - 0.5).slice(0, 3);

    return {
        with_genres: selectedGenres.join(','),
        'primary_release_date.gte': yearGte,
        'primary_release_date.lte': yearLte,
        'vote_average.gte': voteAvg,
        'vote_count.gte': 500,
        sort_by: 'vote_average.desc',
        language: 'en-US',
        page: Math.floor(Math.random() * 3) + 1,
    };
}

// =============================================
//  HOOKS — genre-aware
// =============================================
const GENRE_NAMES = {
    28:'Action',12:'Adventure',16:'Animation',35:'Comedy',80:'Crime',
    99:'Documentary',18:'Drama',10751:'Family',14:'Fantasy',36:'History',
    27:'Horror',10402:'Music',9648:'Mystery',10749:'Romance',878:'Sci-Fi',
    53:'Thriller',10752:'War',37:'Western'
};

const genreHooks = {
    27: ["Something watches from the dark. The Oracle dares you.",
         "Sleep is overrated. This film proves it."],
    53: ["Your pulse will thank you later.",
         "The Oracle senses you crave tension. Delivered."],
    10749: ["A romantic at heart. The Oracle sees through you.",
            "Love stories hit different when the Oracle picks them."],
    878: ["The future called. The Oracle answered.",
          "Your curiosity runs deep. This one rewards it."],
    18: ["The Oracle found weight in your answers. This film carries it.",
         "Not every great film is easy. This one earns every minute."],
    28: ["You chose intensity. The Oracle respects that.",
         "Adrenaline was written in your answers."],
    35: ["The Oracle prescribes laughter. No refills needed.",
         "Life's too short for boring movies. The Oracle agrees."],
    80: ["The Oracle detects a fascination with the morally grey.",
         "Rules were made to be broken. This film knows it."],
    14: ["The Oracle sees a dreamer. This world was built for you.",
         "Reality is optional. The Oracle prefers it that way."],
    9648: ["The Oracle loves a puzzle. So do you, apparently.",
           "Questions without easy answers. The Oracle's specialty."],
    12: ["Adventure found you. The Oracle just pointed the way.",
         "Your answers smell like wanderlust."],
    16: ["Animation isn't just for kids. The Oracle knows better.",
         "Frame by frame, this one was made for you."],
};

const defaultHooks = [
    "The Oracle sees exactly what you need. Trust it.",
    "Your answers reveal a hidden craving. This one satisfies it.",
    "An unexpected choice — but the Oracle knows best.",
    "The stars aligned for this recommendation.",
    "Bold choices deserve bold cinema.",
    "Your vibe? Unmistakable. Here's your match.",
];

function getHook(answers) {
    // Collect all genre IDs from the user's answers
    const selectedGenres = new Set();
    questions.forEach((q, i) => {
        const f = q.filters[answers[i]];
        if (f.genres) f.genres.forEach(g => selectedGenres.add(g));
    });
    // Try to find a genre-specific hook
    for (const gid of selectedGenres) {
        if (genreHooks[gid]) {
            const hooks = genreHooks[gid];
            return hooks[Math.floor(Math.random() * hooks.length)];
        }
    }
    return defaultHooks[Math.floor(Math.random() * defaultHooks.length)];
}

function getWhyText(movie, answers) {
    const selectedGenres = new Set();
    questions.forEach((q, i) => {
        const f = q.filters[answers[i]];
        if (f.genres) f.genres.forEach(g => selectedGenres.add(g));
    });
    const movieGenres = (movie.genre_ids || [])
        .filter(g => selectedGenres.has(g))
        .map(g => GENRE_NAMES[g] || '')
        .filter(Boolean);
    if (movieGenres.length > 0) {
        return `The Oracle matched your ${movieGenres.slice(0, 2).join(' + ')} energy.`;
    }
    return 'The Oracle works in mysterious ways.';
}

// =============================================
//  STATE
// =============================================
let currentQuestion = 0;
let answers = [];
let lastResults = [];
let lastResultIndex = 0;
let currentMovie = null;

// =============================================
//  SCREEN TRANSITIONS
// =============================================
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => {
        s.classList.remove('active');
    });
    const el = document.getElementById(id);
    el.classList.add('active');
    // Re-trigger animation
    el.style.animation = 'none';
    el.offsetHeight; // reflow
    el.style.animation = '';

    // Show/hide stickers — removed
}

// =============================================
//  FLOW
// =============================================
function startOracle() {
    currentQuestion = 0;
    answers = [];
    questions = pickQuestions();
    showQuestion();
}

function showQuestion() {
    const q = questions[currentQuestion];
    const qClass = ['q1', 'q2', 'q3'][currentQuestion];
    document.getElementById('questionProgress').textContent = `${currentQuestion + 1} / 3`;
    document.getElementById('questionText').textContent = q.text;
    document.getElementById('answerA').textContent = q.options[0];
    document.getElementById('answerB').textContent = q.options[1];
    document.getElementById('answerGroup').className = 'answer-group ' + qClass;
    showScreen('question');
}

function answer(choice) {
    answers.push(choice);
    currentQuestion++;

    if (currentQuestion < questions.length) {
        showQuestion();
    } else {
        fetchMovie();
    }
}

function tmdbFetch(path, params) {
    const url = `/api/discover?${new URLSearchParams(params)}`;
    return fetch(url);
}

async function fetchMovie() {
    // Show loading
    const msg = loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
    document.getElementById('loadingText').textContent = msg;
    showScreen('loading');

    try {
        const filters = buildFilters(answers);
        const res = await tmdbFetch('/discover/movie', filters);
        if (!res.ok) throw new Error('TMDB API error');
        const data = await res.json();

        if (!data.results || data.results.length === 0) {
            // Fallback: relax filters
            filters['vote_average.gte'] = 6.0;
            filters['vote_count.gte'] = 200;
            filters.page = 1;
            const res2 = await tmdbFetch('/discover/movie', filters);
            const data2 = await res2.json();
            if (!data2.results || data2.results.length === 0) throw new Error('No movies found');
            lastResults = data2.results;
        } else {
            lastResults = data.results;
        }

        // Shuffle results
        lastResults = lastResults.sort(() => Math.random() - 0.5);
        lastResultIndex = 0;

        // Dramatic delay
        await new Promise(r => setTimeout(r, 1500));
        showResult();
    } catch (err) {
        console.error(err);
        document.getElementById('errorText').textContent =
            'The Oracle stumbled. Check your connection and try again.';
        showScreen('error');
    }
}

function showResult() {
    if (lastResultIndex >= lastResults.length) {
        // Exhausted results, re-fetch
        fetchMovie();
        return;
    }

    const movie = lastResults[lastResultIndex];
    lastResultIndex++;

    // Poster
    const posterImg = document.getElementById('posterImg');
    const posterContainer = document.getElementById('resultPoster');
    posterImg.classList.remove('loaded');
    posterContainer.classList.remove('poster-loaded');
    if (movie.poster_path) {
        posterImg.onload = () => {
            posterImg.classList.add('loaded');
            posterContainer.classList.add('poster-loaded');
        };
        posterImg.src = TMDB_IMG + movie.poster_path;
        posterImg.alt = movie.title;
    } else {
        posterImg.src = '';
        posterImg.alt = 'No poster available';
    }

    // Title
    document.getElementById('resultTitle').textContent = movie.title;

    // Meta: year + rating
    const year = movie.release_date ? movie.release_date.split('-')[0] : '—';
    const rating = movie.vote_average ? movie.vote_average.toFixed(1) : '—';
    document.getElementById('resultMeta').textContent = `${year}  ·  ${rating}/10`;

    // Hook
    document.getElementById('resultHook').textContent =
        '"' + getHook(answers) + '"';

    // Inline details
    const detailsEl = document.getElementById('resultDetails');
    detailsEl.classList.remove('expanded');
    document.getElementById('detailsOverview').textContent =
        movie.overview && movie.overview.trim().length
            ? movie.overview
            : 'No synopsis available yet.';
    document.getElementById('detailsWhy').textContent = getWhyText(movie, answers);

    currentMovie = movie;
    showScreen('result');
}

function toggleDetails() {
    const el = document.getElementById('resultDetails');
    const screen = document.getElementById('result');
    el.classList.toggle('expanded');
    screen.classList.toggle('details-open');
}

function watchAgain() {
    document.getElementById('resultDetails').classList.remove('expanded');
    document.getElementById('result').classList.remove('details-open');
    showResult();
}

function startOver() {
    document.getElementById('resultDetails').classList.remove('expanded');
    document.getElementById('result').classList.remove('details-open');
    showScreen('landing');
}

// =============================================
//  POSTER CLICK → EXPAND DETAILS
// =============================================
document.getElementById('resultPoster').addEventListener('click', toggleDetails);

// =============================================
//  INIT — load token from config.js
// =============================================
// Init — ready
</script>

</body>
</html>
